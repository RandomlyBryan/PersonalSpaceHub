<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PersonalSpace - Team Project Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        glass: "rgba(255, 255, 255, 0.95)",
                        darkGlass: "rgba(30, 41, 59, 0.95)",
                        sidebar: "rgba(36, 0, 70, 0.85)",
                        jokerPurple: "#3c096c",
                        jokerGreen: "#39ff14"
                    }
                }
            }
        }
    </script>

    <style>
        body { background: linear-gradient(135deg, #9d4edd, #70e000); min-height: 100vh; transition: background 0.5s ease; overflow: hidden; font-family: 'Inter', sans-serif; }
        .dark body { background: linear-gradient(135deg, #10002b, #004b23); }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(157, 78, 221, 0.3); box-shadow: 0 8px 32px 0 rgba(60, 9, 108, 0.2); }
        .dark .glass-panel { background: rgba(20, 10, 40, 0.85); color: #e2e8f0; border: 1px solid rgba(57, 255, 20, 0.1); }
        .sidebar { background: rgba(36, 0, 70, 0.7); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(255, 255, 255, 0.1); border-left: 4px solid #39ff14; color: #39ff14; }
        .admin-only { transition: all 0.3s; }
        .admin-only.hidden-tool { display: none !important; }
        .task-card { cursor: grab; transition: transform 0.2s; }
        .task-card:active { cursor: grabbing; }
        .dragging { opacity: 0.5; transform: scale(0.98); }
        .calendar-day { min-height: 80px; padding: 4px; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; background: rgba(255,255,255,0.4); }
        .dark .calendar-day { border-color: #3c096c; background: rgba(30, 41, 59, 0.4); }
    </style>
</head>
<body class="text-slate-800 antialiased flex flex-col h-screen w-screen overflow-hidden">

    <div id="login-overlay" class="fixed inset-0 flex items-center justify-center z-[200] bg-[#10002b]">
        <div class="glass-panel p-8 rounded-3xl w-full max-w-sm border-2 border-jokerPurple shadow-[0_0_50px_rgba(157,78,221,0.3)]">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-jokerGreen tracking-tighter">PersonalSpace</h1>
                <p class="text-white/50 text-xs uppercase tracking-widest">Secure Entry</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-purple-400 font-bold uppercase ml-1">Identity</label>
                    <select id="login-username" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white outline-none focus:border-jokerGreen appearance-none cursor-pointer">
                        <option value="Admin">★ Admin</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] text-purple-400 font-bold uppercase ml-1">Password</label>
                    <div class="relative">
                        <input type="password" id="login-password" placeholder="••••••••" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white outline-none focus:border-jokerGreen placeholder-white/20 pr-10">
                        <button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-white/40 hover:text-jokerGreen"><i id="password-toggle-icon" class="fas fa-eye"></i></button>
                    </div>
                </div>
                <button onclick="handleLogin()" class="w-full bg-jokerGreen hover:bg-green-400 text-black font-black py-3 rounded-xl transition transform active:scale-95 shadow-lg">ACCESS SYSTEM</button>
                <p id="login-error" class="text-red-400 text-[10px] text-center font-bold hidden uppercase animate-pulse">Invalid Credentials</p>
            </div>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden relative">
        <aside class="sidebar w-64 flex-shrink-0 flex flex-col justify-between h-full z-20">
            <div class="p-6 text-white">
                <h1 class="text-2xl font-bold tracking-wider text-green-400">PersonalSpace</h1>
                <p class="text-xs text-white/60 uppercase tracking-wider mt-1">Team Hub</p>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-3 text-white px-4 py-3 rounded-r-lg transition active"><i class="fas fa-home w-5"></i> Dashboard</button>
                <button onclick="switchView('kanban')" id="nav-kanban" class="nav-item w-full flex items-center gap-3 text-white px-4 py-3 rounded-r-lg transition"><i class="fas fa-tasks w-5"></i> Task Tracker</button>
            </nav>

            <div class="p-4 border-t border-purple-500/30">
                <h3 class="text-xs font-bold text-green-400 uppercase mb-3 flex justify-between items-center">Team Members <span id="member-count" class="bg-purple-800 px-2 rounded-full text-[10px]">0</span></h3>
                <div id="admin-tools-members" class="admin-only flex gap-2 mb-3">
                    <input type="text" id="new-member-name" placeholder="Name..." class="w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-sm text-white focus:outline-none">
                    <button onclick="addMember()" class="bg-green-600 hover:bg-green-500 text-black px-2 rounded text-sm"><i class="fas fa-plus"></i></button>
                </div>
                <ul id="team-list" class="space-y-2 max-h-40 overflow-y-auto pr-1"></ul>
            </div>

            <div class="p-4 flex flex-col gap-3 border-t border-purple-500/30">
                <div id="admin-tools-data" class="admin-only flex flex-col gap-2">
                    <button onclick="changeAdminPassword()" class="bg-amber-500/20 hover:bg-amber-500/40 text-amber-200 text-[10px] py-1.5 rounded transition border border-amber-500/30 flex items-center justify-center gap-1">
                        <i class="fas fa-lock"></i> Change Admin Password
                    </button>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="backupData()" class="bg-purple-500/20 hover:bg-purple-500/40 text-[10px] py-1 rounded border border-purple-500/30">Backup</button>
                        <button onclick="clearAllData()" class="bg-red-500/20 hover:bg-red-500/40 text-red-200 text-[10px] py-1 rounded border border-red-500/30">Nuke</button>
                    </div>
                </div>
                <button onclick="logout()" class="text-red-400 text-xs text-left"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                <button onclick="toggleTheme()" class="text-green-400 text-xs text-left"><i class="fas fa-moon mr-2" id="theme-icon"></i>Toggle Theme</button>
            </div>
        </aside>

        <main class="flex-1 relative h-full overflow-hidden flex flex-col bg-white/5 backdrop-blur-sm p-6">
            <div id="view-dashboard" class="flex-1 flex flex-col h-full fade-in">
                <header class="mb-4 text-white flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight text-green-400" id="clock">00:00</h1>
                        <p class="text-sm opacity-90" id="date">Loading...</p>
                    </div>
                    <div id="active-user-display" class="text-right">
                        <p class="text-lg font-bold" id="greeting">Connecting...</p>
                        <span id="current-user-name" class="text-xs bg-green-500 text-black px-2 py-0.5 rounded-full font-bold">Admin</span>
                    </div>
                </header>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 min-h-0">
                    <div class="glass-panel rounded-2xl p-4 flex flex-col h-full">
                        <h2 class="text-sm font-bold mb-3 text-purple-700 dark:text-purple-300"><i class="fas fa-sticky-note mr-2"></i>Quick Notes</h2>
                        <textarea id="notepad" class="flex-1 w-full bg-transparent border-none focus:ring-0 outline-none resize-none text-sm dark:text-white" onchange="saveNotes(this.value)"></textarea>
                    </div>
                    <div class="lg:col-span-2 glass-panel rounded-2xl p-4 overflow-auto">
                        <h2 class="text-sm font-bold mb-3 text-green-600 dark:text-green-400"><i class="fas fa-chart-line mr-2"></i>Active Overview</h2>
                        <div id="quick-task-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div id="view-kanban" class="flex-1 hidden flex-col h-full fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-green-400">Task Tracker</h2>
                    <div class="flex gap-2">
                        <button onclick="toggleReportModal()" class="bg-white/20 text-white px-4 py-2 rounded-lg text-sm border border-white/10">Report</button>
                        <button onclick="openTaskModal()" class="bg-green-500 text-black font-bold px-4 py-2 rounded-lg text-sm">New Task</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 flex-1 overflow-x-auto">
                    <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-slate-400 p-3">
                        <h3 class="font-bold mb-3 dark:text-white">To Do</h3>
                        <div class="flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'todo', 'status')" ondragover="allowDrop(event)" id="col-todo"></div>
                    </div>
                    <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-purple-600 p-3">
                        <h3 class="font-bold mb-3 text-purple-400">In Progress</h3>
                        <div class="flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'inprogress', 'status')" ondragover="allowDrop(event)" id="col-inprogress"></div>
                    </div>
                    <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-green-500 p-3">
                        <h3 class="font-bold mb-3 text-green-400">Executed</h3>
                        <div class="flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'done', 'status')" ondragover="allowDrop(event)" id="col-done"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="report-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-4xl h-[80vh] flex flex-col p-6 shadow-2xl border border-purple-600">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold dark:text-white"><i class="fas fa-clipboard-list mr-2"></i>Team Performance</h2>
                <button onclick="toggleReportModal()" class="text-slate-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex gap-4 mb-6 bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl items-end">
                <input type="date" id="report-start" class="bg-white dark:bg-slate-800 border rounded px-3 py-2 text-sm">
                <input type="date" id="report-end" class="bg-white dark:bg-slate-800 border rounded px-3 py-2 text-sm">
                <button onclick="generateReport()" class="bg-purple-600 text-white px-6 py-2 rounded-lg text-sm">Apply</button>
            </div>
            <div class="flex-1 overflow-auto">
                <table class="w-full text-left text-sm dark:text-slate-300">
                    <thead class="sticky top-0 bg-slate-100 dark:bg-slate-700">
                        <tr><th class="p-3">Task</th><th class="p-3">Assignee</th><th class="p-3">Status</th><th class="p-3">Duration</th></tr>
                    </thead>
                    <tbody id="report-body" class="divide-y dark:divide-slate-700"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // FIREBASE & STATE
        const firebaseConfig = {
            apiKey: "AIzaSyCvfwF-_by5hoUIVoEowKwbzzKF3YkJWy0",
            authDomain: "personalspacehub-3a44d.firebaseapp.com",
            projectId: "personalspacehub-3a44d",
            databaseURL: "https://personalspacehub-3a44d-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const store = {
            theme: localStorage.getItem('nexus_theme') || 'light',
            currentUser: null,
            users: [],
            kanbanTasks: [],
            passwords: {},
            notes: ''
        };

        // AUTH & SECURITY
        window.handleLogin = function() {
            const user = document.getElementById('login-username').value;
            const pass = document.getElementById('login-password').value;
            const correctPass = store.passwords[user] || "1234";
            if (pass === correctPass) {
                document.getElementById('login-overlay').classList.add('hidden');
                store.currentUser = user === "Admin" ? null : user;
                document.getElementById('current-user-name').textContent = user;
                renderKanbanBoard();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        };

        window.changeAdminPassword = function() {
            const currentPass = store.passwords["Admin"] || "1234";
            const verify = prompt("Enter current Admin password:");
            if (verify === currentPass) {
                const newPass = prompt("Enter NEW Admin password:");
                if (newPass && newPass === prompt("Confirm NEW password:")) {
                    store.passwords["Admin"] = newPass;
                    db.ref('projectData/passwords').update(store.passwords).then(() => alert("Password Updated."));
                }
            } else { alert("Verification failed."); }
        };

        // CORE UI LOGIC
        window.switchView = (view) => {
            document.getElementById('view-dashboard').classList.toggle('hidden', view !== 'dashboard');
            document.getElementById('view-kanban').classList.toggle('hidden', view !== 'kanban');
            document.getElementById('nav-dashboard').classList.toggle('active', view === 'dashboard');
            document.getElementById('nav-kanban').classList.toggle('active', view === 'kanban');
        };

        window.toggleTheme = () => {
            store.theme = store.theme === 'light' ? 'dark' : 'light';
            document.body.classList.toggle('dark', store.theme === 'dark');
            localStorage.setItem('nexus_theme', store.theme);
        };

        // DATA LOGIC
        db.ref('projectData').on('value', (snap) => {
            const data = snap.val() || {};
            store.users = data.users || [];
            store.kanbanTasks = data.kanbanTasks || [];
            store.passwords = data.passwords || { "Admin": "1234" };
            renderTeamList();
            renderKanbanBoard();
            updateLoginDropdown();
        });

        function renderTeamList() {
            const list = document.getElementById('team-list');
            list.innerHTML = store.users.map(u => `<li class="text-sm text-white/80 p-1 bg-white/5 rounded">${u}</li>`).join('');
            document.getElementById('member-count').textContent = store.users.length;
        }

        function updateLoginDropdown() {
            const select = document.getElementById('login-username');
            select.innerHTML = `<option value="Admin">★ Admin</option>` + store.users.map(u => `<option value="${u}">${u}</option>`).join('');
        }

        function renderKanbanBoard() {
            ['todo', 'inprogress', 'done'].forEach(status => {
                const container = document.getElementById(`col-${status}`);
                const tasks = store.kanbanTasks.filter(t => t.status === status && (!store.currentUser || t.assignee === store.currentUser));
                container.innerHTML = tasks.map(t => `
                    <div class="task-card bg-white dark:bg-slate-800 p-3 rounded shadow-sm border border-slate-200 dark:border-slate-700">
                        <h4 class="font-bold text-sm dark:text-white">${t.title}</h4>
                        <p class="text-[10px] text-slate-500">${t.assignee || 'Unassigned'}</p>
                    </div>
                `).join('');
            });
        }

        // REPORTING LOGIC
        window.generateReport = function() {
            const tbody = document.getElementById('report-body');
            tbody.innerHTML = '';
            store.kanbanTasks.forEach(t => {
                const statusMap = { 'todo': 'To Do', 'inprogress': 'Doing', 'done': 'Executed' };
                const colorMap = { 'todo': 'text-slate-500', 'inprogress': 'text-purple-500', 'done': 'text-green-500' };
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="p-3 font-bold">${t.title}</td>
                    <td class="p-3">${t.assignee || 'Unassigned'}</td>
                    <td class="p-3 ${colorMap[t.status]} font-bold">${statusMap[t.status]}</td>
                    <td class="p-3">${formatTime(t.log?.inprogress || 0)}</td>
                `;
                tbody.appendChild(tr);
            });
        };

        window.toggleReportModal = () => document.getElementById('report-modal').classList.toggle('hidden');
        window.formatTime = (s) => `${Math.floor(s/60)}m ${s%60}s`;
        window.logout = () => location.reload();
        
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').textContent = now.toDateString();
        }, 1000);
    </script>
</body>
</html>