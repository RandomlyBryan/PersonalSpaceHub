<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PersonalSpace - Team Project Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        glass: "rgba(255, 255, 255, 0.95)",
                        darkGlass: "rgba(30, 41, 59, 0.95)",
                        sidebar: "rgba(36, 0, 70, 0.85)",
                        jokerPurple: "#3c096c",
                        jokerGreen: "#39ff14"
                    }
                }
            }
        }
    </script>

    <style>
        body { background: linear-gradient(135deg, #9d4edd, #70e000); min-height: 100vh; transition: background 0.5s ease; overflow: hidden; font-family: 'Inter', sans-serif; }
        .dark body { background: linear-gradient(135deg, #10002b, #004b23); }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(157, 78, 221, 0.3); box-shadow: 0 8px 32px 0 rgba(60, 9, 108, 0.2); }
        .dark .glass-panel { background: rgba(20, 10, 40, 0.85); color: #e2e8f0; border: 1px solid rgba(57, 255, 20, 0.1); }
        .sidebar { background: rgba(36, 0, 70, 0.7); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(255, 255, 255, 0.1); border-left: 4px solid #39ff14; color: #39ff14; }
        .column-body { min-height: 200px; transition: background-color 0.2s; }
        .column-body.drag-over { background-color: rgba(57, 255, 20, 0.15); border-radius: 0.5rem; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(157, 78, 221, 0.5); border-radius: 3px; }
        .task-card { cursor: grab; }
        .dragging { opacity: 0.5; transform: scale(0.98); }
        .timer-active { animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0%, 100% { text-shadow: 0 0 0 rgba(57, 255, 20, 0); } 50% { text-shadow: 0 0 4px rgba(57, 255, 20, 0.5); } }
        #login-overlay { background: #10002b; z-index: 200; }
        .admin-only.hidden-tool { display: none !important; }
        /* Calendar UI overrides */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid #e2e8f0; border-left: 1px solid #e2e8f0; }
        .calendar-day { min-height: 80px; padding: 4px; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; }
        .cal-event-item { font-size: 0.65rem; padding: 4px; border-radius: 3px; margin-top: 2px; }
        .cal-urgency-low { border-left: 3px solid #39ff14; background: rgba(57, 255, 20, 0.1); }
    </style>
</head>
<body class="text-slate-800 antialiased flex flex-col h-screen w-screen overflow-hidden">

    <div id="login-overlay" class="fixed inset-0 flex items-center justify-center transition-opacity duration-500">
        <div class="glass-panel p-8 rounded-3xl w-full max-w-sm border-2 border-jokerPurple">
            <div class="flex justify-center mb-6"><div class="w-20 h-20 bg-jokerPurple rounded-2xl flex items-center justify-center border-2 border-jokerGreen"><i class="fas fa-user-astronaut text-jokerGreen text-4xl"></i></div></div>
            <h1 class="text-3xl font-bold text-jokerGreen text-center tracking-tighter mb-6">PersonalSpace</h1>
            <div class="space-y-4">
                <select id="login-username" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white appearance-none cursor-pointer"><option value="Admin">★ Admin</option></select>
                <input type="password" id="login-password" placeholder="Password" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white">
                <button onclick="handleLogin()" class="w-full bg-jokerGreen hover:bg-green-400 text-black font-black py-3 rounded-xl transition">ACCESS SYSTEM</button>
                <p id="login-error" class="text-red-400 text-[10px] text-center font-bold hidden uppercase">Invalid Credentials</p>
            </div>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden relative">
        <aside class="sidebar w-64 flex-shrink-0 flex flex-col justify-between h-full z-20">
            <div class="p-6 text-white flex items-center gap-3">
                <i class="fas fa-user-astronaut text-green-400 text-xl"></i>
                <h1 class="text-xl font-bold tracking-wider text-green-400">PersonalSpace</h1>
            </div>

            <div class="px-4 mb-4">
                <div class="w-full bg-purple-900/50 border border-purple-500/30 rounded px-3 py-2 text-sm text-white flex justify-between items-center">
                    <span id="current-user-name">Admin</span>
                    <button onclick="logout()" class="text-red-400 hover:text-red-300"><i class="fas fa-sign-out-alt"></i></button>
                </div>

                <div id="work-session-panel" class="mt-4 p-3 bg-black/40 border border-purple-500/30 rounded-xl">
                    <h3 class="text-[10px] text-purple-400 font-bold uppercase mb-2 flex justify-between">
                        <span>Work Session</span>
                        <span id="session-status-badge" class="text-[8px] px-1 bg-slate-700 text-white rounded">Idle</span>
                    </h3>
                    <div id="global-timer-display" class="text-2xl font-mono text-white mb-3 tracking-tighter text-center">00:00:00</div>
                    <div class="flex gap-2">
                        <button id="btn-session-play" onclick="sessionAction('play')" class="flex-1 bg-green-500 text-black py-2 rounded-lg transition"><i class="fas fa-play"></i></button>
                        <button id="btn-session-pause" onclick="sessionAction('pause')" class="flex-1 bg-amber-500 text-black py-2 rounded-lg transition hidden"><i class="fas fa-pause"></i></button>
                        <button id="btn-session-stop" onclick="sessionAction('stop')" class="bg-red-500 text-white px-4 py-2 rounded-lg transition disabled:opacity-30" disabled><i class="fas fa-stop"></i></button>
                    </div>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-3 text-white px-4 py-3 rounded-lg active"><i class="fas fa-home"></i> Dashboard</button>
                <button onclick="switchView('kanban')" id="nav-kanban" class="nav-item w-full flex items-center gap-3 text-white px-4 py-3 rounded-lg"><i class="fas fa-tasks"></i> Task Tracker</button>
            </nav>

            <div class="p-4 border-t border-purple-500/30">
                <h3 class="text-xs font-bold text-green-400 uppercase mb-3 flex justify-between items-center">Team Members <span id="member-count" class="bg-purple-800 px-2 rounded-full">0</span></h3>
                <div id="admin-tools-members" class="admin-only flex gap-2 mb-3">
                    <input type="text" id="new-member-name" placeholder="Add member..." class="w-full bg-white/10 border rounded px-2 text-sm text-white">
                    <button onclick="addMember()" class="bg-green-600 text-black px-2 rounded"><i class="fas fa-plus"></i></button>
                </div>
                <ul id="team-list" class="space-y-2 max-h-40 overflow-y-auto"></ul>
            </div>
            <div class="p-4 border-t border-purple-500/30">
                <button onclick="changeMyPassword()" class="text-[10px] text-amber-400 block"><i class="fas fa-lock"></i> Update My Password</button>
                <button onclick="toggleTheme()" class="text-green-400 text-xs mt-2"><i class="fas fa-moon" id="theme-icon"></i> Dark/Light</button>
            </div>
        </aside>

        <main class="flex-1 relative overflow-hidden flex flex-col bg-white/5 backdrop-blur-sm">
            <div id="view-dashboard" class="flex-1 overflow-hidden p-6 fade-in flex flex-col">
                <header class="mb-4 text-white shrink-0 flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight text-green-400" id="clock">00:00</h1>
                        <p class="text-sm opacity-90" id="date">Loading date...</p>
                    </div>
                    <div id="header-avatar" class="w-14 h-14 rounded-full bg-purple-900 border-2 border-green-400 shadow-lg overflow-hidden cursor-pointer relative"></div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-10 gap-4 flex-1 min-h-0">
                    <div class="lg:col-span-3 flex flex-col gap-4 h-full">
                        <div class="glass-panel rounded-2xl p-4 h-1/3 flex flex-col">
                            <h2 class="text-sm font-bold mb-2 text-purple-700 dark:text-purple-300"><i class="fas fa-sticky-note"></i> Quick Notes</h2>
                            <textarea id="notepad" class="flex-1 bg-purple-50 dark:bg-slate-900 border-none rounded-lg p-3 resize-none outline-none text-sm" placeholder="Notes..." onchange="saveNotes(this.value)"></textarea>
                        </div>
                        <div class="glass-panel rounded-2xl p-4 flex-1 flex flex-col">
                            <h2 class="text-sm font-bold mb-3 text-green-600 dark:text-green-400"><i class="fas fa-check-circle"></i> Active Progress</h2>
                            <ul id="quick-task-list" class="flex-1 overflow-y-auto space-y-2 pr-1"></ul>
                        </div>
                    </div>
                    <div class="lg:col-span-7 glass-panel rounded-2xl p-4 flex flex-col h-full overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-sm font-bold text-purple-700 dark:text-purple-400"><i class="fas fa-calendar-alt"></i> Schedule</h2>
                            <span id="calendar-month-year" class="font-bold"></span>
                        </div>
                        <div id="calendar-body" class="calendar-grid flex-1"></div>
                    </div>
                </div>
            </div>

            <div id="view-kanban" class="flex-1 overflow-hidden p-6 fade-in hidden flex-col">
                <div class="flex justify-between items-center mb-6 text-white">
                    <h2 class="text-2xl font-bold text-green-400">Task Tracker</h2>
                    <div class="flex gap-2">
                        <div id="kanban-filter-container" class="relative">
                            <input type="text" id="date-range-picker" placeholder="Filter by date..." class="bg-black/40 border border-purple-500/50 text-white text-xs rounded px-4 py-2 outline-none w-48">
                        </div>
                        <button onclick="exportSummaryReport()" class="bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-bold"><i class="fas fa-file-export"></i> Export & Flush</button>
                        <button onclick="openTaskModal()" class="bg-green-500 text-black font-bold px-4 py-2 rounded-lg text-sm"><i class="fas fa-plus"></i> New Task</button>
                    </div>
                </div>
                <div id="kanban-status-view" class="flex-1 overflow-x-auto">
                    <div class="grid grid-cols-3 gap-6 h-full min-w-[800px]">
                        <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-slate-400">
                            <div class="p-3 border-b flex justify-between items-center bg-white/10"><b>To Do</b> <span id="count-todo" class="text-xs">0</span></div>
                            <div class="column-body p-3 flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'todo')" ondragover="allowDrop(event)"></div>
                        </div>
                        <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-purple-600">
                            <div class="p-3 border-b flex justify-between items-center bg-white/10"><b>Doing</b> <span id="count-inprogress" class="text-xs">0</span></div>
                            <div class="column-body p-3 flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'inprogress')" ondragover="allowDrop(event)"></div>
                        </div>
                        <div class="glass-panel rounded-xl flex flex-col h-full border-t-4 border-green-500">
                            <div class="p-3 border-b flex justify-between items-center bg-white/10"><b>Done</b> <span id="count-done" class="text-xs">0</span></div>
                            <div class="column-body p-3 flex-1 overflow-y-auto space-y-3" ondrop="drop(event, 'done')" ondragover="allowDrop(event)"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="task-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-md p-6 border-2 border-purple-500">
            <h2 class="text-xl font-bold mb-4 dark:text-white">Task Details</h2>
            <input type="hidden" id="task-id">
            <input type="text" id="task-title" placeholder="Title" class="w-full bg-slate-100 dark:bg-slate-700 rounded-lg p-3 mb-3 outline-none dark:text-white">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <select id="task-assignee" class="w-full bg-slate-100 dark:bg-slate-700 rounded-lg p-3 outline-none dark:text-white"></select>
                <input type="date" id="task-date" class="w-full bg-slate-100 dark:bg-slate-700 rounded-lg p-3 outline-none dark:text-white">
            </div>
            <textarea id="task-desc" placeholder="Description" rows="3" class="w-full bg-slate-100 dark:bg-slate-700 rounded-lg p-3 mb-4 outline-none dark:text-white"></textarea>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('task-modal')" class="px-4 py-2 text-slate-500">Cancel</button>
                <button onclick="saveTask()" class="bg-purple-600 text-white px-6 py-2 rounded-lg">Save Task</button>
            </div>
        </div>
    </div>

    <script>
        // FIREBASE & CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCvfwF-_by5hoUIVoEowKwbzzKF3YkJWy0",
            authDomain: "personalspacehub-3a44d.firebaseapp.com",
            projectId: "personalspacehub-3a44d",
            databaseURL: "https://personalspacehub-3a44d-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // STATE
        const store = {
            theme: localStorage.getItem('nexus_theme') || 'light',
            currentUser: null,
            users: [],
            kanbanTasks: [],
            avatars: {}, 
            passwords: {},
            workLogs: [], 
            activeSessions: {}, 
            notes: '',
            calendarMonth: new Date().getMonth(),
            calendarYear: new Date().getFullYear()
        };

        // UI HELPERS
        function updateClock() { const n = new Date(); document.getElementById('clock').textContent = n.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hourCycle:'h23'}); document.getElementById('date').textContent = n.toLocaleDateString(undefined, {weekday:'long', month:'long', day:'numeric'}); }
        function loadTheme() { document.body.classList.toggle('dark', store.theme === 'dark'); }
        function toggleTheme() { store.theme = store.theme === 'light' ? 'dark' : 'light'; localStorage.setItem('nexus_theme', store.theme); loadTheme(); }
        function switchView(v) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById(`nav-${v}`).classList.add('active'); document.getElementById('view-dashboard').classList.add('hidden'); document.getElementById('view-kanban').classList.add('hidden'); document.getElementById(`view-${v}`).classList.remove('hidden'); if(v==='kanban') renderKanbanBoard(); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function formatTime(s) { const h = Math.floor(s/3600), m = Math.floor((s%3600)/60); return h>0 ? `${h}h ${m}m` : `${m}m ${s%60}s`; }

        // --- AUTH ---
        function handleLogin() {
            const user = document.getElementById('login-username').value;
            const pass = document.getElementById('login-password').value;
            if (pass === (store.passwords[user] || "1234")) {
                store.currentUser = user === "Admin" ? null : user;
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('current-user-name').textContent = user;
                localStorage.setItem('ps_session_user', user);
                updateUIForUser();
            } else { document.getElementById('login-error').classList.remove('hidden'); }
        }

        function logout() { localStorage.removeItem('ps_session_user'); location.reload(); }

        // --- NEW: ROLE-BASED REPORTING LOGIC ---
        function exportSummaryReport() {
            const picker = document.getElementById('date-range-picker')._flatpickr;
            const range = picker.selectedDates;
            let start = range[0], end = range[1];

            const isMember = store.currentUser !== null;
            const actingUser = store.currentUser || "Admin";

            let content = `PERSONAL SPACE - ${isMember ? 'INDIVIDUAL' : 'TEAM'} ACTIVITY REPORT\n`;
            content += `Generated By: ${actingUser}\n`;
            content += `Export Date: ${new Date().toLocaleString()}\n`;
            if (start) content += `Period: ${start.toDateString()} to ${end ? end.toDateString() : 'Present'}\n`;
            content += "========================================================\n\n";

            // 1. WORK SESSION SUMMARY
            content += isMember ? "[YOUR TRACKED HOURS]\n" : "[TEAM TOTAL HOURS SUMMARY]\n";
            const usersToReport = isMember ? [actingUser] : ["Admin", ...store.users];
            
            usersToReport.forEach(u => {
                let logs = store.workLogs.filter(l => l.user === u);
                if (start && end) {
                    logs = logs.filter(l => { const d = new Date(l.date); return d >= start && d <= end; });
                }
                const total = logs.reduce((acc, curr) => acc + curr.duration, 0);
                content += `${u.padEnd(15)} : ${formatTime(total)}\n`;
            });

            // 2. TASK SUMMARY
            content += `\n${isMember ? '[YOUR TASKS]' : '[ALL PROJECT TASKS]'}\n`;
            const tasksToReport = isMember 
                ? store.kanbanTasks.filter(t => t.assignee === actingUser) 
                : store.kanbanTasks;

            tasksToReport.forEach(t => {
                content += `- ${t.title.padEnd(30)} [${t.status.toUpperCase()}] Assigned: ${t.assignee || 'Any'}\n`;
            });

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${actingUser}_Report_${new Date().toISOString().slice(0,10)}.txt`;
            a.click();

            if (!isMember && confirm("Flush finished tasks for the whole team?")) {
                store.kanbanTasks = store.kanbanTasks.filter(t => t.status !== 'done');
                pushToCloud();
            }
        }

        // TIMER LOGIC
        function sessionAction(type) {
            const user = store.currentUser || "Admin";
            const session = store.activeSessions[user] || { isPlaying: false, lastStartTime: null, accumulatedTime: 0 };
            const now = Date.now();

            if (type === 'play') { session.isPlaying = true; session.lastStartTime = now; }
            else if (type === 'pause') {
                if (session.isPlaying) session.accumulatedTime += Math.floor((now - session.lastStartTime)/1000);
                session.isPlaying = false; session.lastStartTime = null;
            } else if (type === 'stop') {
                if(!confirm("Finalize and log session?")) return;
                let total = session.accumulatedTime + (session.isPlaying ? Math.floor((now - session.lastStartTime)/1000) : 0);
                if (total > 0) store.workLogs.push({ user, duration: total, date: new Date().toISOString().split('T')[0], timestamp: now });
                delete store.activeSessions[user];
                pushToCloud();
                return;
            }
            store.activeSessions[user] = session;
            pushToCloud();
        }

        function refreshSessionUI() {
            const user = store.currentUser || "Admin";
            const session = store.activeSessions[user];
            const display = document.getElementById('global-timer-display');
            const playBtn = document.getElementById('btn-session-play');
            const pauseBtn = document.getElementById('btn-session-pause');
            const stopBtn = document.getElementById('btn-session-stop');

            if (!session) { 
                display.textContent = "00:00:00"; playBtn.classList.remove('hidden'); pauseBtn.classList.add('hidden'); stopBtn.disabled = true; return; 
            }
            stopBtn.disabled = false;
            let current = session.accumulatedTime + (session.isPlaying ? Math.floor((Date.now() - session.lastStartTime)/1000) : 0);
            const h = Math.floor(current/3600).toString().padStart(2,'0'), m = Math.floor((current%3600)/60).toString().padStart(2,'0'), s = (current%60).toString().padStart(2,'0');
            display.textContent = `${h}:${m}:${s}`;
            playBtn.classList.toggle('hidden', session.isPlaying);
            pauseBtn.classList.toggle('hidden', !session.isPlaying);
        }

        // FIREBASE SYNC
        function pushToCloud() {
            db.ref('projectData').update({
                users: store.users, kanbanTasks: store.kanbanTasks, avatars: store.avatars,
                passwords: store.passwords, workLogs: store.workLogs, activeSessions: store.activeSessions
            });
        }

        function updateUIForUser() {
            const name = store.currentUser || "Admin";
            document.getElementById('current-user-name').textContent = name;
            document.querySelectorAll('.admin-only').forEach(el => el.classList.toggle('hidden-tool', store.currentUser !== null));
            renderKanbanBoard();
            renderTeamList();
        }

        // KANBAN
        let draggedId = null;
        window.dragStart = (e, id) => { draggedId = id; e.target.classList.add('dragging'); };
        window.allowDrop = (e) => e.preventDefault();
        window.drop = (e, status) => {
            const task = store.kanbanTasks.find(t => t.id === draggedId);
            if (task) { task.status = status; pushToCloud(); }
        };

        function renderKanbanBoard() {
            ['todo', 'inprogress', 'done'].forEach(s => {
                const container = document.querySelector(`[ondrop="drop(event, '${s}')"]`);
                const tasks = store.kanbanTasks.filter(t => t.status === s && (!store.currentUser || t.assignee === store.currentUser));
                document.getElementById(`count-${s}`).textContent = tasks.length;
                container.innerHTML = '';
                tasks.forEach(t => {
                    const el = document.createElement('div');
                    el.className = 'task-card bg-white dark:bg-slate-800 p-3 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700';
                    el.draggable = true; el.ondragstart = (e) => dragStart(e, t.id);
                    el.innerHTML = `<b>${t.title}</b><div class="text-[10px] mt-2 opacity-60">${t.assignee || 'Unassigned'}</div>`;
                    container.appendChild(el);
                });
            });
        }

        function renderTeamList() {
            const list = document.getElementById('team-list');
            list.innerHTML = '';
            document.getElementById('member-count').textContent = store.users.length;
            const assigneeSelect = document.getElementById('task-assignee');
            assigneeSelect.innerHTML = '<option value="">Unassigned</option>';
            store.users.forEach(u => {
                const li = document.createElement('li');
                li.className = "text-sm text-white/80 bg-white/5 p-2 rounded flex justify-between";
                li.innerHTML = `<span>${u}</span>`;
                list.appendChild(li);
                assigneeSelect.add(new Option(u, u));
            });
        }

        function addMember() {
            const name = document.getElementById('new-member-name').value.trim();
            if(name && !store.users.includes(name)) { store.users.push(name); pushToCloud(); }
        }

        function saveTask() {
            const task = { id: Date.now().toString(), title: document.getElementById('task-title').value, assignee: document.getElementById('task-assignee').value, description: document.getElementById('task-desc').value, date: document.getElementById('task-date').value, status: 'todo' };
            store.kanbanTasks.push(task); pushToCloud(); closeModal('task-modal');
        }

        function openTaskModal() { document.getElementById('task-modal').classList.remove('hidden'); }

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            updateClock();
            setInterval(updateClock, 1000);
            setInterval(refreshSessionUI, 1000);
            flatpickr("#date-range-picker", { mode: "range", theme: "dark" });

            db.ref('projectData').on('value', snap => {
                const data = snap.val();
                if (data) {
                    Object.assign(store, data);
                    renderTeamList();
                    renderKanbanBoard();
                    
                    const loginSelect = document.getElementById('login-username');
                    loginSelect.innerHTML = '<option value="Admin">★ Admin</option>';
                    store.users.forEach(u => loginSelect.add(new Option(u, u)));
                }
            });
        });
    </script>
</body>
</html>